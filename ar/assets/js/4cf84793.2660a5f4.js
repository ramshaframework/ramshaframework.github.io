"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[2429],{8249:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"basics/persistence/entity-framework-core/connections-strings","title":"Connections Strings","description":"Ramsha provides a flexible and powerful connection string management system that supports multiple databases, connection string aliases, and automatic resolution.","source":"@site/docs/basics/persistence/entity-framework-core/connections-strings.md","sourceDirName":"basics/persistence/entity-framework-core","slug":"/basics/persistence/entity-framework-core/connections-strings","permalink":"/ar/docs/basics/persistence/entity-framework-core/connections-strings","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/ar/docs/basics/persistence/entity-framework-core/overview"},"next":{"title":"Database Migrations","permalink":"/ar/docs/basics/persistence/entity-framework-core/ef-core-migrations"}}');var s=i(4848),o=i(8453);const r={sidebar_position:2},c="Connections Strings",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"1. Define Connection Strings in appsettings.json",id:"1-define-connection-strings-in-appsettingsjson",level:3},{value:"2. Specify Connection String for DbContext",id:"2-specify-connection-string-for-dbcontext",level:3},{value:"3. Register DbContext in Module",id:"3-register-dbcontext-in-module",level:3},{value:"Connection String Aliases",id:"connection-string-aliases",level:2},{value:"Why Use Aliases?",id:"why-use-aliases",level:3},{value:"Configuring Aliases",id:"configuring-aliases",level:3},{value:"How Aliases Work",id:"how-aliases-work",level:3},{value:"Advanced Scenarios",id:"advanced-scenarios",level:2},{value:"Multiple DbContexts with Different Connections",id:"multiple-dbcontexts-with-different-connections",level:3},{value:"Dynamic Connection String Resolution",id:"dynamic-connection-string-resolution",level:3},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"connections-strings",children:"Connections Strings"})}),"\n",(0,s.jsx)(e.p,{children:"Ramsha provides a flexible and powerful connection string management system that supports multiple databases, connection string aliases, and automatic resolution."}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"The connection string system in Ramsha allows you to:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Define multiple database connections with names"}),"\n",(0,s.jsx)(e.li,{children:"Use attributes to specify which connection a DbContext should use"}),"\n",(0,s.jsx)(e.li,{children:"Create aliases for connection strings"}),"\n",(0,s.jsx)(e.li,{children:"Replace DbContext implementations while maintaining proper connection resolution"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,s.jsx)(e.h3,{id:"1-define-connection-strings-in-appsettingsjson",children:"1. Define Connection Strings in appsettings.json"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "ConnectionStrings": {\n    "Default": "Server=(localdb)\\\\MSSQLLocalDB;Database=MyAppDb;Trusted_Connection=True;",\n    "MainDb": "Server=localhost;Database=MainDb;User=sa;Password=your_password;",\n    "LogDb": "Server=localhost;Database=LogDb;User=sa;Password=your_password;",\n    "ArchiveDb": "Server=localhost;Database=ArchiveDb;User=sa;Password=your_password;"\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-specify-connection-string-for-dbcontext",children:"2. Specify Connection String for DbContext"}),"\n",(0,s.jsxs)(e.p,{children:["Use the ",(0,s.jsx)(e.code,{children:"[ConnectionString]"})," attribute to specify which connection string a DbContext should use:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'[ConnectionString("MainDb")]\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\n{\n    public AppDbContext(DbContextOptions<AppDbContext> options)\n        : base(options)\n    {\n    }\n    \n    // Your DbSets here\n    public DbSet<User> Users { get; set; }\n    public DbSet<Product> Products { get; set; }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-register-dbcontext-in-module",children:"3. Register DbContext in Module"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\n{\n    public override void ConfigureServices(ServiceConfigurationContext context)\n    {\n        // Register DbContext with options\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\n        {\n            // Configure DbContext options here\n        });\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"connection-string-aliases",children:"Connection String Aliases"}),"\n",(0,s.jsx)(e.h3,{id:"why-use-aliases",children:"Why Use Aliases?"}),"\n",(0,s.jsx)(e.p,{children:"Aliases allow you to map multiple names to the same connection string. This is useful when:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"You have legacy code using different connection string names"}),"\n",(0,s.jsx)(e.li,{children:"You want to provide backward compatibility"}),"\n",(0,s.jsx)(e.li,{children:"You need to standardize connection string names across multiple applications"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"configuring-aliases",children:"Configuring Aliases"}),"\n",(0,s.jsxs)(e.p,{children:["Configure aliases in your module's ",(0,s.jsx)(e.code,{children:"ConfigureServices"})," method:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'public class AppModule : RamshaModule\n{\n    public override void ConfigureServices(ServiceConfigurationContext context)\n    {\n        // Configure connection string aliases\n        context.Services.Configure<ConnectionStringsOptions>(options =>\n        {\n            options.ConfigureAliases(builder =>\n            {\n                // Map "MainDb" and "Primary" to "Default" connection string\n                builder.Map("Default", ["MainDb", "Primary"]);\n                \n                // Map "LoggingDb" to "LogDb" connection string\n                builder.Map("LogDb", "LoggingDb");\n            });\n        });\n        \n        // Register your DbContext\n        context.Services.AddRamshaDbContext<AppDbContext>();\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"how-aliases-work",children:"How Aliases Work"}),"\n",(0,s.jsx)(e.p,{children:"With the configuration above:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("MainDb")]'}),' will use the "Default" connection string']}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("Primary")]'}),' will use the "Default" connection string']}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("LoggingDb")]'}),' will use the "LogDb" connection string']}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"This means all these DbContext attributes will work with the same underlying connection strings:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'// All these will use the "Default" connection string\n[ConnectionString("Default")]\n[ConnectionString("MainDb")]\n[ConnectionString("Primary")]\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\n{\n    // ...\n}\n\n// This will use the "LogDb" connection string\n[ConnectionString("LogDb")]\n[ConnectionString("LoggingDb")]\npublic class LogDbContext : RamshaEFDbContext<LogDbContext>\n{\n    // ...\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"advanced-scenarios",children:"Advanced Scenarios"}),"\n",(0,s.jsx)(e.h3,{id:"multiple-dbcontexts-with-different-connections",children:"Multiple DbContexts with Different Connections"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'// Main application database\n[ConnectionString("AppDb")]\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\n{\n    public DbSet<User> Users { get; set; }\n    public DbSet<Product> Products { get; set; }\n}\n\n// Reporting database (read-only replica)\n[ConnectionString("ReportDb")]\npublic class ReportDbContext : RamshaEFDbContext<ReportDbContext>\n{\n    public DbSet<SalesReport> SalesReports { get; set; }\n    public DbSet<Analytics> Analytics { get; set; }\n}\n\n// Audit/logging database\n[ConnectionString("AuditDb")]\npublic class AuditDbContext : RamshaEFDbContext<AuditDbContext>\n{\n    public DbSet<AuditLog> AuditLogs { get; set; }\n    public DbSet<SystemLog> SystemLogs { get; set; }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"dynamic-connection-string-resolution",children:"Dynamic Connection String Resolution"}),"\n",(0,s.jsx)(e.p,{children:"You can implement custom connection string resolution logic:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'public class TenantConnectionStringResolver : IConnectionStringResolver\n{\n    private readonly IOptions<ConnectionStringsOptions> _options;\n    private readonly ITenantService _tenantService;\n    \n    public TenantConnectionStringResolver(\n        IOptions<ConnectionStringsOptions> options,\n        ITenantService tenantService)\n    {\n        _options = options;\n        _tenantService = tenantService;\n    }\n    \n    public async Task<string?> ResolveAsync(string? connectionStringName = null)\n    {\n        var tenant = await _tenantService.GetCurrentTenantAsync();\n        \n        // Use tenant-specific connection string if available\n        var tenantSpecificName = $"{connectionStringName}_{tenant.Id}";\n        \n        return _options.Value.Get(tenantSpecificName) \n               ?? _options.Value.Get(connectionStringName ?? "Default");\n    }\n}\n\n// Register in module\ncontext.Services.Replace<IConnectionStringResolver, TenantConnectionStringResolver>();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(e.p,{children:"Ramsha's connection string management system provides:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Attribute-based configuration"})," using ",(0,s.jsx)(e.code,{children:"[ConnectionString]"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Alias support"})," for backward compatibility and standardization"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"handle DbContext replacement connection string"})," with automatic connection string resolution"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Flexible resolution"})," through ",(0,s.jsx)(e.code,{children:"IConnectionStringResolver"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"This system allows you to manage complex multi-database scenarios while maintaining clean, maintainable code."}),"\n",(0,s.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./ef-core-migrations",children:"EfCore Database Migrations"})})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./repositories",children:"Repositories"})})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./global-data-filters",children:"Global Query Filters"})})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>c});var t=i(6540);const s={},o=t.createContext(s);function r(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);