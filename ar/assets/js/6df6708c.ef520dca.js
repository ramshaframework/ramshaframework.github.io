"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[4619],{6598:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"basics/persistence/entity-framework-core/repositories","title":"Repositories","description":"Repository Pattern in Ramsha","source":"@site/docs/basics/persistence/entity-framework-core/repositories.md","sourceDirName":"basics/persistence/entity-framework-core","slug":"/basics/persistence/entity-framework-core/repositories","permalink":"/ar/docs/basics/persistence/entity-framework-core/repositories","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Database Migrations","permalink":"/ar/docs/basics/persistence/entity-framework-core/ef-core-migrations"},"next":{"title":"Global Query Filters","permalink":"/ar/docs/basics/persistence/entity-framework-core/global-data-filters"}}');var r=s(4848),n=s(8453);const o={sidebar_position:4},a="Repositories",c={},l=[{value:"Repository Pattern in Ramsha",id:"repository-pattern-in-ramsha",level:2},{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Define Your Entity",id:"1-define-your-entity",level:3},{value:"2. Enable The Default Repositories Registration",id:"2-enable-the-default-repositories-registration",level:3},{value:"Base Repository Interface",id:"base-repository-interface",level:2},{value:"Base Repository Interfaces",id:"base-repository-interfaces",level:3},{value:"Default Repositories",id:"default-repositories",level:2},{value:"Using Default Repository Implementation",id:"using-default-repository-implementation",level:3},{value:"Custom Repositories",id:"custom-repositories",level:2},{value:"Creating a Custom Repository",id:"creating-a-custom-repository",level:3},{value:"1. Define Repository Interface",id:"1-define-repository-interface",level:4},{value:"2. Implement Custom Repository",id:"2-implement-custom-repository",level:4},{value:"3. Register Custom Repository",id:"3-register-custom-repository",level:4},{value:"4. Use Custom Repository",id:"4-use-custom-repository",level:4},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Custom Repository Base Classes",id:"custom-repository-base-classes",level:3},{value:"Then Configure Options:",id:"then-configure-options",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"repositories",children:"Repositories"})}),"\n",(0,r.jsx)(t.h2,{id:"repository-pattern-in-ramsha",children:"Repository Pattern in Ramsha"}),"\n",(0,r.jsx)(t.p,{children:"The repository pattern in Ramsha provides a clean abstraction layer between your domain logic and data access code. It offers both default implementations for common operations and flexibility to create custom repositories when needed."}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"Ramsha's repository system provides:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Default repositories"})," for common CRUD operations"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Custom repositories"})," for domain-specific queries"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Automatic registration"})," through fluent configuration"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Unit of Work integration"})," for transaction management"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(t.h3,{id:"1-define-your-entity",children:"1. Define Your Entity"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public sealed class Product : Entity<Guid>\n{\n    public string Name { get; set; }\n    public decimal Price { get; set; }\n    public Guid CategoryId { get; set; }\n    public Category Category { get; set; }\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"2-enable-the-default-repositories-registration",children:"2. Enable The Default Repositories Registration"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\n{\n    public override void ConfigureServices(ServiceConfigurationContext context)\n    {\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\n        {\n            // this will Add default repositories for all entities\n            options.AddDefaultRepositories(true);\n        });\n    }\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"base-repository-interface",children:"Base Repository Interface"}),"\n",(0,r.jsx)(t.p,{children:"Ramsha provides a Generic and base interfaces for repositories:"}),"\n",(0,r.jsx)(t.h3,{id:"base-repository-interfaces",children:"Base Repository Interfaces"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"// Marker interface for all repositories\npublic interface IRepository { }\n\n// Repository for entities without specifying ID type\npublic interface IRepository<TEntity> : IRepository\n    where TEntity : IEntity\n{\n    Task<TEntity?> AddAsync(TEntity entity);\n    Task<List<TEntity>> GetListAsync();\n    // others common methods\n}\n\n// Repository for entities with specific ID type\npublic interface IRepository<TEntity, TId> : IRepository<TEntity>\n    where TId : IEquatable<TId>\n    where TEntity : IEntity<TId>\n{\n    Task<bool> DeleteAsync(TId id);\n    Task<TEntity?> FindAsync(TId id);\n    // others common methods\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"default-repositories",children:"Default Repositories"}),"\n",(0,r.jsx)(t.h3,{id:"using-default-repository-implementation",children:"Using Default Repository Implementation"}),"\n",(0,r.jsx)(t.p,{children:"When you register default repositories, Ramsha automatically provides implementations for common operations:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"// Registration\noptions.AddDefaultRepositories(true); // For all entities\n"})}),"\n",(0,r.jsx)(t.h1,{id:"or",children:"or"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"options.AddDefaultRepository<Product>();  // For specific entity\n"})}),"\n",(0,r.jsx)(t.h1,{id:"so-you-can-use-in-service",children:"So you can use in service"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public class ProductService\n{\n    private readonly IRepository<Product, Guid> _productRepository;\n    \n    public ProductService(IRepository<Product, Guid> productRepository)\n    {\n        _productRepository = productRepository;\n    }\n    \n    public async Task<Product?> GetProductAsync(Guid id)\n    {\n        return await _productRepository.FindAsync(id);\n    }\n    \n    public async Task<List<Product>> GetExpensiveProductsAsync()\n    {\n        return await _productRepository.GetListAsync(\n            p => p.Price > 1000\n        );\n    }\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"custom-repositories",children:"Custom Repositories"}),"\n",(0,r.jsx)(t.h3,{id:"creating-a-custom-repository",children:"Creating a Custom Repository"}),"\n",(0,r.jsx)(t.p,{children:"When you need domain-specific query logic, create a custom repository:"}),"\n",(0,r.jsx)(t.h4,{id:"1-define-repository-interface",children:"1. Define Repository Interface"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public interface IProductRepository : IRepository<Product, Guid>\n{\n    // Custom methods for domain-specific queries\n    Task<List<Product>> GetProductsByCategoryAsync(Guid categoryId);\n    // other methods\n}\n"})}),"\n",(0,r.jsx)(t.h4,{id:"2-implement-custom-repository",children:"2. Implement Custom Repository"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public class ProductRepository : EFCoreRepository<AppDbContext, Product, Guid>, IProductRepository\n{\n    public async Task<List<Product>> GetProductsByCategoryAsync(Guid categoryId)\n    {\n        var context = await GetDbContextAsync();\n        return await context.Set<Product>()\n            .Where(p => p.CategoryId == categoryId)\n            .ToListAsync();\n    }\n}\n"})}),"\n",(0,r.jsx)(t.h4,{id:"3-register-custom-repository",children:"3. Register Custom Repository"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"context.Services.AddRamshaDbContext<AppDbContext>(options =>\n{\n    options.AddRepository<Product, IProductRepository, ProductRepository>();\n});\n"})}),"\n",(0,r.jsx)(t.h4,{id:"4-use-custom-repository",children:"4. Use Custom Repository"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public class ProductAppService(IProductRepository productRepository)\n{\n    public async Task<decimal> CalculateCategoryValueAsync(Guid categoryId)\n    {\n        var products = await productRepository.GetProductsByCategoryAsync(categoryId);\n        return products.Sum(p => p.Price);\n    }\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,r.jsx)(t.h3,{id:"custom-repository-base-classes",children:"Custom Repository Base Classes"}),"\n",(0,r.jsx)(t.p,{children:"You can create a custom base repositories and replace the default:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"public class AppRepository<TEntity> \n    : EFCoreRepository<AppDbContext, TEntity>\n    where TEntity : class, IEntity\n{\n    // add here Shared methods\n}\npublic class AppRepository<TEntity, TKey> \n    : EFCoreRepository<AppDbContext, TEntity, TKey>\n    where TEntity : class, IEntity<TKey>\n    where TKey : IEquatable<TKey>\n{\n    // add here Shared methods\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"then-configure-options",children:"Then Configure Options:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"context.Services.AddRamshaDbContext<AppDbContext>(options =>\n{\n    //...\n    options.SetDefaultRepositoryClasses(\n        typeof(AppRepository<,>),   \n        typeof(AppRepository<>)       \n    );\n});\n"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{href:"./global-data-filters",children:"Global Query Filters"})})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{href:"../unit-of-work",children:"UnitOfWork"})})}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>a});var i=s(6540);const r={},n=i.createContext(r);function o(e){const t=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);