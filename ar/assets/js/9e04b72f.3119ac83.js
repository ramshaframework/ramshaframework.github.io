"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[200],{689:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"basics/persistence/entity-framework-core/overview","title":"Overview","description":"EF Core Integration with Ramsha","source":"@site/docs/basics/persistence/entity-framework-core/overview.md","sourceDirName":"basics/persistence/entity-framework-core","slug":"/basics/persistence/entity-framework-core/overview","permalink":"/ar/docs/basics/persistence/entity-framework-core/overview","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"EntityFrameworkCore","permalink":"/ar/docs/category/entityframeworkcore"},"next":{"title":"Connections Strings","permalink":"/ar/docs/basics/persistence/entity-framework-core/connections-strings"}}');var r=t(4848),o=t(8453);const s={sidebar_position:1},c="Overview",a={},l=[{value:"EF Core Integration with Ramsha",id:"ef-core-integration-with-ramsha",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1- Create Your DbContext",id:"1--create-your-dbcontext",level:3},{value:"2- Install Required Packages",id:"2--install-required-packages",level:3},{value:"3. Configure Your Application Module",id:"3-configure-your-application-module",level:3},{value:"Package Architecture",id:"package-architecture",level:2},{value:"Core Package (<code>Ramsha.EntityFrameworkCore</code>)",id:"core-package-ramshaentityframeworkcore",level:3},{value:"Provider Packages",id:"provider-packages",level:3},{value:"Configuration Guide",id:"configuration-guide",level:2},{value:"Step 1: Declare Provider Dependency",id:"step-1-declare-provider-dependency",level:3},{value:"Step 2: Register DbContext",id:"step-2-register-dbcontext",level:3},{value:"Step 3: Configure Connection Strings",id:"step-3-configure-connection-strings",level:3},{value:"DbContext Replacement",id:"dbcontext-replacement",level:2},{value:"Replacing DbContext Implementations",id:"replacing-dbcontext-implementations",level:3},{value:"Example: Replacing DbContext",id:"example-replacing-dbcontext",level:3},{value:"How Connection String Resolution Works with Replacement",id:"how-connection-string-resolution-works-with-replacement",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"overview",children:"Overview"})}),"\n",(0,r.jsx)(n.h2,{id:"ef-core-integration-with-ramsha",children:"EF Core Integration with Ramsha"}),"\n",(0,r.jsxs)(n.p,{children:["Ramsha Framework provides a structured and extensible integration with Entity Framework Core through a base ",(0,r.jsx)(n.code,{children:"DbContext"})," abstraction called ",(0,r.jsx)(n.code,{children:"RamshaEFDbContext"}),". This integration simplifies database operations while maintaining flexibility and adhering to best practices."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(n.h3,{id:"1--create-your-dbcontext",children:"1- Create Your DbContext"}),"\n",(0,r.jsxs)(n.p,{children:["Instead of inheriting directly from ",(0,r.jsx)(n.code,{children:"DbContext"}),", create your application DbContext by inheriting from ",(0,r.jsx)(n.code,{children:"RamshaEFDbContext"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'[ConnectionString("Default")]\npublic class AppDbContext(DbContextOptions<AppDbContext> options) \n    : RamshaEFDbContext<AppDbContext>(options)\n{\n    // Define your DbSets\n    public DbSet<Product> Products { get; set; }\n    public DbSet<Customer> Customers { get; set; }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2--install-required-packages",children:"2- Install Required Packages"}),"\n",(0,r.jsx)(n.p,{children:"First, install the core EF package and your chosen database provider:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Core EF package (always required)\n# This is typically included in your main Ramsha setup\n\n# Choose ONE database provider:\ndotnet add package Ramsha.EntityFrameworkCore.SqlServer      # For SQL Server\n# OR\ndotnet add package Ramsha.EntityFrameworkCore.PostgreSql   # For PostgreSQL\n# OR\ndotnet add package Ramsha.EntityFrameworkCore.Sqlite       # For SQLite\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-configure-your-application-module",children:"3. Configure Your Application Module"}),"\n",(0,r.jsxs)(n.p,{children:["Register dependencies in your module's ",(0,r.jsx)(n.code,{children:"Register"})," method:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class Module : RamshaModule\n{\n    public override void Register(RegisterContext context)\n    {\n        base.Register(context);\n        \n        // Declare dependency on your chosen provider module\n        context.DependsOn<EntityFrameworkCoreSqlServerModule>();\n        // OR: context.DependsOn<EntityFrameworkCorePostgreSqlModule>();\n        // OR: context.DependsOn<EntityFrameworkCoreSqliteModule>();\n    }\n    \n    public override void BuildServices(BuildServicesContext context)\n    {\n        base.BuildServices(context);\n\n        // Register your DbContext in the DI container\n        context.Services.AddRamshaDbContext<AppDbContext>();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"package-architecture",children:"Package Architecture"}),"\n",(0,r.jsxs)(n.h3,{id:"core-package-ramshaentityframeworkcore",children:["Core Package (",(0,r.jsx)(n.code,{children:"Ramsha.EntityFrameworkCore"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"This foundational package provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"RamshaEFDbContext"})})," - Base DbContext with built-in functionality"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Global query filter infrastructure"})," - Automatic filtering for soft delete, tenant isolation, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit of Work integration"})," - Transaction management"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base repository implementations"})," - Consistent data access patterns"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": This package is ",(0,r.jsx)(n.strong,{children:"database-agnostic"})," and doesn't include any specific provider."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"provider-packages",children:"Provider Packages"}),"\n",(0,r.jsx)(n.p,{children:"Each provider package includes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Database-specific provider implementation"}),"\n",(0,r.jsxs)(n.li,{children:["Automatic reference to the core ",(0,r.jsx)(n.code,{children:"Ramsha.EntityFrameworkCore"})," package"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Choose only one provider package based on your database:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Database"}),(0,r.jsx)(n.th,{children:"Package"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SQL Server"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Ramsha.EntityFrameworkCore.SqlServer"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Ramsha.EntityFrameworkCore.PostgreSql"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SQLite"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Ramsha.EntityFrameworkCore.Sqlite"})})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-guide",children:"Configuration Guide"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-declare-provider-dependency",children:"Step 1: Declare Provider Dependency"}),"\n",(0,r.jsxs)(n.p,{children:["In your module's ",(0,r.jsx)(n.code,{children:"Register"})," phase, declare which database provider you're using:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public override void Register(RegisterContext context)\n{\n    base.Register(context);\n    \n    // SQL Server Example\n    context.DependsOn<EntityFrameworkCoreSqlServerModule>();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-register-dbcontext",children:"Step 2: Register DbContext"}),"\n",(0,r.jsxs)(n.p,{children:["In your module's ",(0,r.jsx)(n.code,{children:"BuildServices"})," phase, register your DbContext:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public override void BuildServices(BuildServicesContext context)\n{\n    base.BuildServices(context);\n    \n    // Clean Architecture: Typically done in Persistence layer module\n    context.Services.AddRamshaDbContext<AppDbContext>();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-configure-connection-strings",children:"Step 3: Configure Connection Strings"}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"ConnectionString"})," attribute to specify which connection string to use:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'[ConnectionString("Default")]  // Uses "Default" connection string from appsettings\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\n{\n    // Your DbContext implementation\n}\n\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"dbcontext-replacement",children:"DbContext Replacement"}),"\n",(0,r.jsx)(n.h3,{id:"replacing-dbcontext-implementations",children:"Replacing DbContext Implementations"}),"\n",(0,r.jsx)(n.p,{children:"Ramsha allows you to replace DbContext implementations while maintaining proper connection string resolution. This is useful when:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"You want to extend an existing DbContext"}),"\n",(0,r.jsx)(n.li,{children:"You need to customize DbContext behavior for specific modules"}),"\n",(0,r.jsx)(n.li,{children:"You're using modular architecture where different modules provide their own DbContexts"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-replacing-dbcontext",children:"Example: Replacing DbContext"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'// Interface for identity module\npublic interface IIdentityDbContext\n{\n    DbSet<User> Users { get; set; }\n    DbSet<Role> Roles { get; set; }\n}\n\n// Implementation in identity module\n[ConnectionString("IdentityDb")]\npublic class IdentityDbContext : RamshaEFDbContext<IdentityDbContext>, IIdentityDbContext\n{\n    public DbSet<User> Users { get; set; }\n    public DbSet<Role> Roles { get; set; }\n}\n\n// In your main application, replace IdentityDbContext with AppDbContext\npublic class AppModule : RamshaModule\n{\n    public override void ConfigureServices(ServiceConfigurationContext context)\n    {\n        // Register AppDbContext and replace IIdentityDbContext\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\n        {\n            options.ReplaceDbContext<IIdentityDbContext>();\n        });\n        \n        // Other services...\n    }\n}\n\n// AppDbContext implements IIdentityDbContext\n[ConnectionString("MainDb")]\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>, IIdentityDbContext\n{\n    // IIdentityDbContext implementation\n    public DbSet<User> Users { get; set; }\n    public DbSet<Role> Roles { get; set; }\n    \n    // Additional AppDbContext properties\n    public DbSet<Product> Products { get; set; }\n    public DbSet<Order> Orders { get; set; }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"how-connection-string-resolution-works-with-replacement",children:"How Connection String Resolution Works with Replacement"}),"\n",(0,r.jsx)(n.p,{children:"When you replace a DbContext, the connection string resolution follows these rules:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Direct Attribute Usage"}),": When a service requests ",(0,r.jsx)(n.code,{children:"IIdentityDbContext"}),", it gets ",(0,r.jsx)(n.code,{children:"AppDbContext"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connection String Lookup"}),": The system looks for ",(0,r.jsx)(n.code,{children:"[ConnectionString]"})," attribute on ",(0,r.jsx)(n.code,{children:"AppDbContext"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"String Resolution"}),': Finds "MainDb" connection string from configuration']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Alias Check"}),': If "MainDb" is an alias, resolves to the actual connection string name']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This means that even though ",(0,r.jsx)(n.code,{children:"IIdentityDbContext"}),' originally used "IdentityDb" connection string, after replacement it uses whatever connection string ',(0,r.jsx)(n.code,{children:"AppDbContext"})," is configured with."]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"After setting up your DbContext, explore:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./connections-strings",children:"Connection String"})})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./ef-core-migrations",children:"EFCore Migrations"})})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./repositories",children:"Repositories"})})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./global-data-filters",children:"Global Query Filters"})})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var i=t(6540);const r={},o=i.createContext(r);function s(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);