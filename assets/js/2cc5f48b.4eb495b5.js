"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[4274],{759:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"basics/infrastructure/entity-framework-core/repositories","title":"Repositories","description":"Repository Pattern in Ramsha","source":"@site/docs/basics/infrastructure/entity-framework-core/repositories.md","sourceDirName":"basics/infrastructure/entity-framework-core","slug":"/basics/infrastructure/entity-framework-core/repositories","permalink":"/docs/basics/infrastructure/entity-framework-core/repositories","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Database Migrations","permalink":"/docs/basics/infrastructure/entity-framework-core/ef-core-migrations"},"next":{"title":"Global Query Filters","permalink":"/docs/basics/infrastructure/entity-framework-core/global-data-filters"}}');var i=t(4848),n=t(8453);const o={sidebar_position:4},a="Repositories",c={},l=[{value:"Repository Pattern in Ramsha",id:"repository-pattern-in-ramsha",level:2},{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Define Your Entity",id:"1-define-your-entity",level:3},{value:"2. Enable The Default Repositories Registration",id:"2-enable-the-default-repositories-registration",level:3},{value:"Base Repository Interface",id:"base-repository-interface",level:2},{value:"Base Repository Interfaces",id:"base-repository-interfaces",level:3},{value:"Default Repositories",id:"default-repositories",level:2},{value:"Using Default Repository Implementation",id:"using-default-repository-implementation",level:3},{value:"Custom Repositories",id:"custom-repositories",level:2},{value:"Creating a Custom Repository",id:"creating-a-custom-repository",level:3},{value:"1. Define Repository Interface",id:"1-define-repository-interface",level:4},{value:"2. Implement Custom Repository",id:"2-implement-custom-repository",level:4},{value:"3. Register Custom Repository",id:"3-register-custom-repository",level:4},{value:"4. Use Custom Repository",id:"4-use-custom-repository",level:4},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Custom Repository Base Classes",id:"custom-repository-base-classes",level:3},{value:"Then Configure Options:",id:"then-configure-options",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"repositories",children:"Repositories"})}),"\n",(0,i.jsx)(r.h2,{id:"repository-pattern-in-ramsha",children:"Repository Pattern in Ramsha"}),"\n",(0,i.jsx)(r.p,{children:"The repository pattern in Ramsha provides a clean abstraction layer between your domain logic and data access code. It offers both default implementations for common operations and flexibility to create custom repositories when needed."}),"\n",(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(r.p,{children:"Ramsha's repository system provides:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Default repositories"})," for common CRUD operations"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Custom repositories"})," for domain-specific queries"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Automatic registration"})," through fluent configuration"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Unit of Work integration"})," for transaction management"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(r.h3,{id:"1-define-your-entity",children:"1. Define Your Entity"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public sealed class Product : Entity<Guid>\r\n{\r\n    public string Name { get; set; }\r\n    public decimal Price { get; set; }\r\n    public Guid CategoryId { get; set; }\r\n    public Category Category { get; set; }\r\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"2-enable-the-default-repositories-registration",children:"2. Enable The Default Repositories Registration"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\r\n{\r\n    public override void ConfigureServices(ServiceConfigurationContext context)\r\n    {\r\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\r\n        {\r\n            // this will Add default repositories for all entities\r\n            options.AddDefaultRepositories(true);\r\n        });\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"base-repository-interface",children:"Base Repository Interface"}),"\n",(0,i.jsx)(r.p,{children:"Ramsha provides a Generic and base interfaces for repositories:"}),"\n",(0,i.jsx)(r.h3,{id:"base-repository-interfaces",children:"Base Repository Interfaces"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"// Marker interface for all repositories\r\npublic interface IRepository { }\r\n\r\n// Repository for entities without specifying ID type\r\npublic interface IRepository<TEntity> : IRepository\r\n    where TEntity : IEntity\r\n{\r\n    Task<TEntity?> AddAsync(TEntity entity);\r\n    Task<List<TEntity>> GetListAsync();\r\n    // others common methods\r\n}\r\n\r\n// Repository for entities with specific ID type\r\npublic interface IRepository<TEntity, TId> : IRepository<TEntity>\r\n    where TId : IEquatable<TId>\r\n    where TEntity : IEntity<TId>\r\n{\r\n    Task<bool> DeleteAsync(TId id);\r\n    Task<TEntity?> FindAsync(TId id);\r\n    // others common methods\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"default-repositories",children:"Default Repositories"}),"\n",(0,i.jsx)(r.h3,{id:"using-default-repository-implementation",children:"Using Default Repository Implementation"}),"\n",(0,i.jsx)(r.p,{children:"When you register default repositories, Ramsha automatically provides implementations for common operations:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"// Registration\r\noptions.AddDefaultRepositories(true); // For all entities\n"})}),"\n",(0,i.jsx)(r.h1,{id:"or",children:"or"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"options.AddDefaultRepository<Product>();  // For specific entity\n"})}),"\n",(0,i.jsx)(r.h1,{id:"so-you-can-use-in-service",children:"So you can use in service"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class ProductService\r\n{\r\n    private readonly IRepository<Product, Guid> _productRepository;\r\n    \r\n    public ProductService(IRepository<Product, Guid> productRepository)\r\n    {\r\n        _productRepository = productRepository;\r\n    }\r\n    \r\n    public async Task<Product?> GetProductAsync(Guid id)\r\n    {\r\n        return await _productRepository.FindAsync(id);\r\n    }\r\n    \r\n    public async Task<List<Product>> GetExpensiveProductsAsync()\r\n    {\r\n        return await _productRepository.GetListAsync(\r\n            p => p.Price > 1000\r\n        );\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"custom-repositories",children:"Custom Repositories"}),"\n",(0,i.jsx)(r.h3,{id:"creating-a-custom-repository",children:"Creating a Custom Repository"}),"\n",(0,i.jsx)(r.p,{children:"When you need domain-specific query logic, create a custom repository:"}),"\n",(0,i.jsx)(r.h4,{id:"1-define-repository-interface",children:"1. Define Repository Interface"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public interface IProductRepository : IRepository<Product, Guid>\r\n{\r\n    // Custom methods for domain-specific queries\r\n    Task<List<Product>> GetProductsByCategoryAsync(Guid categoryId);\r\n    // other methods\r\n}\n"})}),"\n",(0,i.jsx)(r.h4,{id:"2-implement-custom-repository",children:"2. Implement Custom Repository"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class ProductRepository : EFCoreRepository<AppDbContext, Product, Guid>, IProductRepository\r\n{\r\n    public async Task<List<Product>> GetProductsByCategoryAsync(Guid categoryId)\r\n    {\r\n        var context = await GetDbContextAsync();\r\n        return await context.Set<Product>()\r\n            .Where(p => p.CategoryId == categoryId)\r\n            .ToListAsync();\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.h4,{id:"3-register-custom-repository",children:"3. Register Custom Repository"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"context.Services.AddRamshaDbContext<AppDbContext>(options =>\r\n{\r\n    options.AddRepository<Product, IProductRepository, ProductRepository>();\r\n});\n"})}),"\n",(0,i.jsx)(r.h4,{id:"4-use-custom-repository",children:"4. Use Custom Repository"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class ProductAppService(IProductRepository productRepository)\r\n{\r\n    public async Task<decimal> CalculateCategoryValueAsync(Guid categoryId)\r\n    {\r\n        var products = await productRepository.GetProductsByCategoryAsync(categoryId);\r\n        return products.Sum(p => p.Price);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,i.jsx)(r.h3,{id:"custom-repository-base-classes",children:"Custom Repository Base Classes"}),"\n",(0,i.jsx)(r.p,{children:"You can create a custom base repositories and replace the default:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class AppRepository<TEntity> \r\n    : EFCoreRepository<AppDbContext, TEntity>\r\n    where TEntity : class, IEntity\r\n{\r\n    // add here Shared methods\r\n}\r\npublic class AppRepository<TEntity, TKey> \r\n    : EFCoreRepository<AppDbContext, TEntity, TKey>\r\n    where TEntity : class, IEntity<TKey>\r\n    where TKey : IEquatable<TKey>\r\n{\r\n    // add here Shared methods\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"then-configure-options",children:"Then Configure Options:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"context.Services.AddRamshaDbContext<AppDbContext>(options =>\r\n{\r\n    //...\r\n    options.SetDefaultRepositoryClasses(\r\n        typeof(AppRepository<,>),   \r\n        typeof(AppRepository<>)       \r\n    );\r\n});\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.a,{href:"./global-data-filters",children:"Global Query Filters"})})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.a,{href:"../unit-of-work",children:"UnitOfWork"})})}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>a});var s=t(6540);const i={},n=s.createContext(i);function o(e){const r=s.useContext(n);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(n.Provider,{value:r},e.children)}}}]);