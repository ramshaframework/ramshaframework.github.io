"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[2429],{8249:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"basics/persistence/entity-framework-core/connections-strings","title":"Connections Strings","description":"Ramsha provides a flexible and powerful connection string management system that supports multiple databases, connection string aliases, and automatic resolution.","source":"@site/docs/basics/persistence/entity-framework-core/connections-strings.md","sourceDirName":"basics/persistence/entity-framework-core","slug":"/basics/persistence/entity-framework-core/connections-strings","permalink":"/docs/basics/persistence/entity-framework-core/connections-strings","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/docs/basics/persistence/entity-framework-core/overview"},"next":{"title":"Database Migrations","permalink":"/docs/basics/persistence/entity-framework-core/ef-core-migrations"}}');var s=i(4848),r=i(8453);const o={sidebar_position:2},c="Connections Strings",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"1. Define Connection Strings in appsettings.json",id:"1-define-connection-strings-in-appsettingsjson",level:3},{value:"2. Specify Connection String for DbContext",id:"2-specify-connection-string-for-dbcontext",level:3},{value:"3. Register DbContext in Module",id:"3-register-dbcontext-in-module",level:3},{value:"Connection String Aliases",id:"connection-string-aliases",level:2},{value:"Why Use Aliases?",id:"why-use-aliases",level:3},{value:"Configuring Aliases",id:"configuring-aliases",level:3},{value:"How Aliases Work",id:"how-aliases-work",level:3},{value:"Advanced Scenarios",id:"advanced-scenarios",level:2},{value:"Multiple DbContexts with Different Connections",id:"multiple-dbcontexts-with-different-connections",level:3},{value:"Dynamic Connection String Resolution",id:"dynamic-connection-string-resolution",level:3},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"connections-strings",children:"Connections Strings"})}),"\n",(0,s.jsx)(e.p,{children:"Ramsha provides a flexible and powerful connection string management system that supports multiple databases, connection string aliases, and automatic resolution."}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"The connection string system in Ramsha allows you to:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Define multiple database connections with names"}),"\n",(0,s.jsx)(e.li,{children:"Use attributes to specify which connection a DbContext should use"}),"\n",(0,s.jsx)(e.li,{children:"Create aliases for connection strings"}),"\n",(0,s.jsx)(e.li,{children:"Replace DbContext implementations while maintaining proper connection resolution"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,s.jsx)(e.h3,{id:"1-define-connection-strings-in-appsettingsjson",children:"1. Define Connection Strings in appsettings.json"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\r\n  "ConnectionStrings": {\r\n    "Default": "Server=(localdb)\\\\MSSQLLocalDB;Database=MyAppDb;Trusted_Connection=True;",\r\n    "MainDb": "Server=localhost;Database=MainDb;User=sa;Password=your_password;",\r\n    "LogDb": "Server=localhost;Database=LogDb;User=sa;Password=your_password;",\r\n    "ArchiveDb": "Server=localhost;Database=ArchiveDb;User=sa;Password=your_password;"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-specify-connection-string-for-dbcontext",children:"2. Specify Connection String for DbContext"}),"\n",(0,s.jsxs)(e.p,{children:["Use the ",(0,s.jsx)(e.code,{children:"[ConnectionString]"})," attribute to specify which connection string a DbContext should use:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'[ConnectionString("MainDb")]\r\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\r\n{\r\n    public AppDbContext(DbContextOptions<AppDbContext> options)\r\n        : base(options)\r\n    {\r\n    }\r\n    \r\n    // Your DbSets here\r\n    public DbSet<User> Users { get; set; }\r\n    public DbSet<Product> Products { get; set; }\r\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-register-dbcontext-in-module",children:"3. Register DbContext in Module"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\r\n{\r\n    public override void ConfigureServices(ServiceConfigurationContext context)\r\n    {\r\n        // Register DbContext with options\r\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\r\n        {\r\n            // Configure DbContext options here\r\n        });\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"connection-string-aliases",children:"Connection String Aliases"}),"\n",(0,s.jsx)(e.h3,{id:"why-use-aliases",children:"Why Use Aliases?"}),"\n",(0,s.jsx)(e.p,{children:"Aliases allow you to map multiple names to the same connection string. This is useful when:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"You have legacy code using different connection string names"}),"\n",(0,s.jsx)(e.li,{children:"You want to provide backward compatibility"}),"\n",(0,s.jsx)(e.li,{children:"You need to standardize connection string names across multiple applications"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"configuring-aliases",children:"Configuring Aliases"}),"\n",(0,s.jsxs)(e.p,{children:["Configure aliases in your module's ",(0,s.jsx)(e.code,{children:"ConfigureServices"})," method:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'public class AppModule : RamshaModule\r\n{\r\n    public override void ConfigureServices(ServiceConfigurationContext context)\r\n    {\r\n        // Configure connection string aliases\r\n        context.Services.Configure<ConnectionStringsOptions>(options =>\r\n        {\r\n            options.ConfigureAliases(builder =>\r\n            {\r\n                // Map "MainDb" and "Primary" to "Default" connection string\r\n                builder.Map("Default", ["MainDb", "Primary"]);\r\n                \r\n                // Map "LoggingDb" to "LogDb" connection string\r\n                builder.Map("LogDb", "LoggingDb");\r\n            });\r\n        });\r\n        \r\n        // Register your DbContext\r\n        context.Services.AddRamshaDbContext<AppDbContext>();\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"how-aliases-work",children:"How Aliases Work"}),"\n",(0,s.jsx)(e.p,{children:"With the configuration above:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("MainDb")]'}),' will use the "Default" connection string']}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("Primary")]'}),' will use the "Default" connection string']}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:'[ConnectionString("LoggingDb")]'}),' will use the "LogDb" connection string']}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"This means all these DbContext attributes will work with the same underlying connection strings:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'// All these will use the "Default" connection string\r\n[ConnectionString("Default")]\r\n[ConnectionString("MainDb")]\r\n[ConnectionString("Primary")]\r\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\r\n{\r\n    // ...\r\n}\r\n\r\n// This will use the "LogDb" connection string\r\n[ConnectionString("LogDb")]\r\n[ConnectionString("LoggingDb")]\r\npublic class LogDbContext : RamshaEFDbContext<LogDbContext>\r\n{\r\n    // ...\r\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"advanced-scenarios",children:"Advanced Scenarios"}),"\n",(0,s.jsx)(e.h3,{id:"multiple-dbcontexts-with-different-connections",children:"Multiple DbContexts with Different Connections"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'// Main application database\r\n[ConnectionString("AppDb")]\r\npublic class AppDbContext : RamshaEFDbContext<AppDbContext>\r\n{\r\n    public DbSet<User> Users { get; set; }\r\n    public DbSet<Product> Products { get; set; }\r\n}\r\n\r\n// Reporting database (read-only replica)\r\n[ConnectionString("ReportDb")]\r\npublic class ReportDbContext : RamshaEFDbContext<ReportDbContext>\r\n{\r\n    public DbSet<SalesReport> SalesReports { get; set; }\r\n    public DbSet<Analytics> Analytics { get; set; }\r\n}\r\n\r\n// Audit/logging database\r\n[ConnectionString("AuditDb")]\r\npublic class AuditDbContext : RamshaEFDbContext<AuditDbContext>\r\n{\r\n    public DbSet<AuditLog> AuditLogs { get; set; }\r\n    public DbSet<SystemLog> SystemLogs { get; set; }\r\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"dynamic-connection-string-resolution",children:"Dynamic Connection String Resolution"}),"\n",(0,s.jsx)(e.p,{children:"You can implement custom connection string resolution logic:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csharp",children:'public class TenantConnectionStringResolver : IConnectionStringResolver\r\n{\r\n    private readonly IOptions<ConnectionStringsOptions> _options;\r\n    private readonly ITenantService _tenantService;\r\n    \r\n    public TenantConnectionStringResolver(\r\n        IOptions<ConnectionStringsOptions> options,\r\n        ITenantService tenantService)\r\n    {\r\n        _options = options;\r\n        _tenantService = tenantService;\r\n    }\r\n    \r\n    public async Task<string?> ResolveAsync(string? connectionStringName = null)\r\n    {\r\n        var tenant = await _tenantService.GetCurrentTenantAsync();\r\n        \r\n        // Use tenant-specific connection string if available\r\n        var tenantSpecificName = $"{connectionStringName}_{tenant.Id}";\r\n        \r\n        return _options.Value.Get(tenantSpecificName) \r\n               ?? _options.Value.Get(connectionStringName ?? "Default");\r\n    }\r\n}\r\n\r\n// Register in module\r\ncontext.Services.Replace<IConnectionStringResolver, TenantConnectionStringResolver>();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(e.p,{children:"Ramsha's connection string management system provides:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Attribute-based configuration"})," using ",(0,s.jsx)(e.code,{children:"[ConnectionString]"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Alias support"})," for backward compatibility and standardization"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"handle DbContext replacement connection string"})," with automatic connection string resolution"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Flexible resolution"})," through ",(0,s.jsx)(e.code,{children:"IConnectionStringResolver"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"This system allows you to manage complex multi-database scenarios while maintaining clean, maintainable code."}),"\n",(0,s.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./ef-core-migrations",children:"EfCore Database Migrations"})})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./repositories",children:"Repositories"})})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"./global-data-filters",children:"Global Query Filters"})})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>c});var t=i(6540);const s={},r=t.createContext(s);function o(n){const e=t.useContext(r);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);