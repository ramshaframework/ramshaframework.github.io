"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[9730],{8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>t});var i=n(6540);const r={},o=i.createContext(r);function l(e){const s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:s},e.children)}},9703:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"basics/authorization","title":"Authorization","description":"Ramsha provides a flexible and extensible authorization system that integrates seamlessly with ASP.NET Core [Authorize] attributes, while supporting custom permission value resolvers and multiple providers.","source":"@site/docs/basics/authorization.md","sourceDirName":"basics","slug":"/basics/authorization","permalink":"/docs/basics/authorization","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Settings","permalink":"/docs/basics/settings"},"next":{"title":"Caching","permalink":"/docs/category/caching"}}');var r=n(4848),o=n(8453);const l={sidebar_position:5},t="Authorization",c={},a=[{value:"Permission Definitions",id:"permission-definitions",level:2},{value:"Example",id:"example",level:3},{value:"Checking Permissions",id:"checking-permissions",level:2},{value:"Permission Value Resolvers",id:"permission-value-resolvers",level:2},{value:"Built-in Resolver Example",id:"built-in-resolver-example",level:3},{value:"Custom Resolver Example",id:"custom-resolver-example",level:3},{value:"Permission Status",id:"permission-status",level:2},{value:"Registering Permission Value Resolvers",id:"registering-permission-value-resolvers",level:2},{value:"Using <code>[Authorize]</code> Attribute",id:"using-authorize-attribute",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"authorization",children:"Authorization"})}),"\n",(0,r.jsxs)(s.p,{children:["Ramsha provides a ",(0,r.jsx)(s.strong,{children:"flexible and extensible authorization system"})," that integrates seamlessly with ASP.NET Core ",(0,r.jsx)(s.code,{children:"[Authorize]"})," attributes, while supporting ",(0,r.jsx)(s.strong,{children:"custom permission value resolvers"})," and multiple providers."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"permission-definitions",children:"Permission Definitions"}),"\n",(0,r.jsxs)(s.p,{children:["Permissions in Ramsha are defined using the ",(0,r.jsx)(s.code,{children:"IPermissionDefinitionProvider"})," interface. Each permission belongs to a ",(0,r.jsx)(s.strong,{children:"group"})," and can have ",(0,r.jsx)(s.strong,{children:"child permissions"})," to form a hierarchical structure."]}),"\n",(0,r.jsx)(s.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:'public static class ProductPermissions\n{\n    public const string GroupName = "products";\n\n    public static class Manage\n    {\n        public const string Default = $"{GroupName}:manage";\n        public const string Create = $"{GroupName}:manage:create";\n        public const string Update = $"{GroupName}:manage:update";\n        public const string Delete = $"{GroupName}:manage:delete";\n    }\n}\n\npublic class ProductPermissionsDefinition : IPermissionDefinitionProvider\n{\n    public void Define(IPermissionDefinitionContext context)\n    {\n        context.Group(ProductPermissions.GroupName, g =>\n        {\n            g.Permission(ProductPermissions.Manage.Default).Children(c =>\n            {\n                c.Add(ProductPermissions.Manage.Create);\n                c.Add(ProductPermissions.Manage.Update);\n                c.Add(ProductPermissions.Manage.Delete);\n            });\n        });\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"GroupName"})," organizes related permissions"]}),"\n",(0,r.jsxs)(s.li,{children:["Permissions can have ",(0,r.jsx)(s.strong,{children:"children"}),", creating hierarchical permission structures"]}),"\n",(0,r.jsxs)(s.li,{children:["Each permission can specify ",(0,r.jsx)(s.strong,{children:"providers"}),", which control which resolvers are executed"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"checking-permissions",children:"Checking Permissions"}),"\n",(0,r.jsxs)(s.p,{children:["Permissions can be checked manually using ",(0,r.jsx)(s.code,{children:"IPermissionChecker"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:"public class ProductAppService(IPermissionChecker permissionChecker)\n{\n\n    public async Task<bool> CanUserCreateProductAsync(ClaimsPrincipal? user)\n    {\n        return await permissionChecker.IsAssignedAsync(user, ProductPermissions.Manage.Create);\n    }\n}\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Useful for ",(0,r.jsx)(s.strong,{children:"conditional UI rendering"}),", background jobs, or programmatic logic"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IPermissionChecker"})," internally calls the ",(0,r.jsx)(s.strong,{children:"resolver system"})," for permission evaluation"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"permission-value-resolvers",children:"Permission Value Resolvers"}),"\n",(0,r.jsxs)(s.p,{children:["Resolvers determine whether a permission is granted. Each resolver returns a ",(0,r.jsx)(s.code,{children:"PermissionStatus"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"Allow"})," \u2192 permission granted, stop further evaluation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"Deny"})," \u2192 permission denied, stop further evaluation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"None"})," \u2192 continue to the next resolver"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Only resolvers whose ",(0,r.jsx)(s.strong,{children:"provider name matches"})," the permission's ",(0,r.jsx)(s.code,{children:"Providers"})," list are executed."]}),"\n",(0,r.jsx)(s.h3,{id:"built-in-resolver-example",children:"Built-in Resolver Example"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:'public class UserPermissionValueResolver(IPermissionStore store)\n    : PermissionValueResolver("U")\n{\n    public override async Task<PermissionStatus> ResolveAsync(PermissionResolveContext context)\n    {\n        var userId = context.Principal?.FindUserId();\n        if (userId is null) return PermissionStatus.None;\n\n        var isAssigned = await store.IsAssignedAsync(\n            context.Permission.Name, GetProviderName(), userId);\n\n        return isAssigned ? PermissionStatus.Allow : PermissionStatus.None;\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:'"U"'})," is the ",(0,r.jsx)(s.strong,{children:"provider name"})," for this resolver"]}),"\n",(0,r.jsx)(s.li,{children:"Only permissions specifying this provider will execute this resolver"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"custom-resolver-example",children:"Custom Resolver Example"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:'public class RoleBasedPermissionResolver(IRoleStore roleStore)\n    : PermissionValueResolver("R")\n{\n    public override async Task<PermissionStatus> ResolveAsync(PermissionResolveContext context)\n    {\n        var userId = context.Principal?.FindUserId();\n        if (userId is null) return PermissionStatus.None;\n\n        var hasRolePermission = await roleStore.HasPermissionAsync(userId, context.Permission.Name);\n        return hasRolePermission ? PermissionStatus.Allow : PermissionStatus.None;\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:'"R"'})," ensures this resolver is applied only for permissions using that provider"]}),"\n",(0,r.jsxs)(s.li,{children:["You can create ",(0,r.jsx)(s.strong,{children:"multiple custom resolvers"})," for different scenarios"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"permission-status",children:"Permission Status"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:"public enum PermissionStatus\n{\n    None = 0,  // Not determined yet\n    Allow = 1, // Granted\n    Deny = 2   // Explicitly denied\n}\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Resolvers are executed ",(0,r.jsx)(s.strong,{children:"in order"})]}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsxs)(s.strong,{children:["first resolver to return ",(0,r.jsx)(s.code,{children:"Allow"})," or ",(0,r.jsx)(s.code,{children:"Deny"})," stops further evaluation"]})]}),"\n",(0,r.jsxs)(s.li,{children:["If all resolvers return ",(0,r.jsx)(s.code,{children:"None"}),", the ",(0,r.jsxs)(s.strong,{children:["final status is ",(0,r.jsx)(s.code,{children:"Deny"})]})]}),"\n",(0,r.jsx)(s.li,{children:"This ensures predictable and consistent permission evaluation"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"registering-permission-value-resolvers",children:"Registering Permission Value Resolvers"}),"\n",(0,r.jsxs)(s.p,{children:["Resolvers are registered during the ",(0,r.jsx)(s.strong,{children:"configuration phase"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:"context.Configure<RamshaPermissionOptions>(options =>\n{\n    options.ValueResolvers.Add<UserPermissionValueResolver>();\n\n    // Control execution order\n    options.ValueResolvers.AddBefore<UserPermissionValueResolver, RoleBasedPermissionResolver>();\n});\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.strong,{children:"order of resolvers is important"})]}),"\n",(0,r.jsxs)(s.li,{children:["Only resolvers whose ",(0,r.jsx)(s.strong,{children:"provider matches the permission"})," are executed"]}),"\n",(0,r.jsxs)(s.li,{children:["You can use ",(0,r.jsx)(s.code,{children:"AddBefore"})," or ",(0,r.jsx)(s.code,{children:"AddAfter"})," to control execution order"]}),"\n",(0,r.jsx)(s.li,{children:"Custom resolvers can be added for advanced scenarios"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsxs)(s.h2,{id:"using-authorize-attribute",children:["Using ",(0,r.jsx)(s.code,{children:"[Authorize]"})," Attribute"]}),"\n",(0,r.jsx)(s.p,{children:"Permissions can be enforced declaratively on controllers or endpoints:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-csharp",children:'\npublic class ProductsController : RamshaApiController\n{\n    [Authorize(Permission = ProductPermissions.Manage.Create)]\n    [HttpPost("create")]\n    public async Task<IActionResult> CreateProduct()\n    {\n        return Ok();\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"[Authorize]"})," internally ",(0,r.jsxs)(s.strong,{children:["uses ",(0,r.jsx)(s.code,{children:"IPermissionChecker"})]})," and the resolver system"]}),"\n",(0,r.jsxs)(s.li,{children:["Ensures ",(0,r.jsx)(s.strong,{children:"consistent permission evaluation"})," across manual checks and attribute-based authorization"]}),"\n",(0,r.jsxs)(s.li,{children:["Works with ",(0,r.jsx)(s.strong,{children:"hierarchical permissions"})," and ",(0,r.jsx)(s.strong,{children:"custom resolvers"})]}),"\n",(0,r.jsxs)(s.li,{children:["Respects the ",(0,r.jsx)(s.strong,{children:"provider filtering"})," for each resolver"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"./caching/overview",children:"Caching"})})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"./messaging/local-messaging",children:"Local Messaging"})})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"./best-practices",children:"Best Practices"})})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);