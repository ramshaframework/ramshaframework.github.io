"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[6321],{5712:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"basics/infrastructure/entity-framework-core/global-data-filters","title":"Global Query Filters","description":"Global query filters in Ramsha automatically apply filtering conditions to all queries for specific entity types. This is particularly useful for implementing cross-cutting concerns like soft delete, multi-tenancy, or entity state management without repeating the same conditions throughout your codebase.","source":"@site/docs/basics/infrastructure/entity-framework-core/global-data-filters.md","sourceDirName":"basics/infrastructure/entity-framework-core","slug":"/basics/infrastructure/entity-framework-core/global-data-filters","permalink":"/docs/basics/infrastructure/entity-framework-core/global-data-filters","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/basics/infrastructure/entity-framework-core/global-data-filters.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Repositories","permalink":"/docs/basics/infrastructure/entity-framework-core/repositories"},"next":{"title":"Unit of Work","permalink":"/docs/basics/infrastructure/unit-of-work"}}');var n=r(4848),l=r(8453);const s={sidebar_position:5},a="Global Query Filters",c={},o=[{value:"Built-in Filters",id:"built-in-filters",level:2},{value:"1. Soft Delete Filter",id:"1-soft-delete-filter",level:3},{value:"Implementation:",id:"implementation",level:4},{value:"Disable Soft Deleted Filter:",id:"disable-soft-deleted-filter",level:4},{value:"Custom Filters",id:"custom-filters",level:2},{value:"Custom Active/Inactive Filter",id:"custom-activeinactive-filter",level:3},{value:"Create a Custom Active Filter:",id:"create-a-custom-active-filter",level:4},{value:"Usage Examples:",id:"usage-examples",level:4},{value:"Combining Multiple Filters",id:"combining-multiple-filters",level:2},{value:"Disable specific filters when needed",id:"disable-specific-filters-when-needed",level:3},{value:"Default Filter State Value:",id:"default-filter-state-value",level:2},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"global-query-filters",children:"Global Query Filters"})}),"\n",(0,n.jsx)(t.p,{children:"Global query filters in Ramsha automatically apply filtering conditions to all queries for specific entity types. This is particularly useful for implementing cross-cutting concerns like soft delete, multi-tenancy, or entity state management without repeating the same conditions throughout your codebase."}),"\n",(0,n.jsx)(t.h2,{id:"built-in-filters",children:"Built-in Filters"}),"\n",(0,n.jsx)(t.p,{children:"Ramsha provides built-in global filters for common scenarios like soft delete. These filters are automatically applied to entities that implement specific interfaces."}),"\n",(0,n.jsx)(t.h3,{id:"1-soft-delete-filter",children:"1. Soft Delete Filter"}),"\n",(0,n.jsx)(t.p,{children:"Ramsha includes a built-in soft delete filter that automatically filters out deleted entities."}),"\n",(0,n.jsx)(t.h4,{id:"implementation",children:"Implementation:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"// Your entity implements ISoftDelete\r\npublic class Product : Entity<Guid>, ISoftDelete\r\n{\r\n    public string Name { get; set; } = string.Empty;\r\n    public decimal Price { get; set; }\r\n    \r\n    // ISoftDelete properties (automatically filtered)\r\n    public string? DeletedBy { get; set; }\r\n    public DateTime? DeletionDate { get; set; }\r\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Usage - automatically filters out ",(0,n.jsx)(t.strong,{children:"deleted"})," products"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public class ProductService(IRepository<Product, Guid> productRepository)\r\n{\r\n    public async Task<List<Product>> GetAllProductsAsync()\r\n    {\r\n        // Automatically excludes products where IsDeleted == true\r\n        return await _productRepository.GetListAsync();\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h4,{id:"disable-soft-deleted-filter",children:"Disable Soft Deleted Filter:"}),"\n",(0,n.jsxs)(t.p,{children:["Sometimes may need to disable the global filter so we can use ",(0,n.jsx)(t.code,{children:"IGlobalQueryFilterManager"})," to Disable/Enable the Global filters:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public class AdminProductService (\r\n        IRepository<Product, Guid> productRepository,\r\n        IGlobalQueryFilterManager globalFilterManager)\r\n{\r\n    \r\n    public async Task<List<Product>> GetAllProductsIncludingDeletedAsync()\r\n    {\r\n        // Temporarily disable soft delete filter\r\n        using (globalFilterManager.Disable<ISoftDelete>())\r\n        {\r\n            // Returns all products including deleted ones\r\n            return await productRepository.GetListAsync();\r\n        }\r\n        // Filter is automatically re-enabled after the using block\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"custom-filters",children:"Custom Filters"}),"\n",(0,n.jsx)(t.p,{children:"While Ramsha has built-in soft delete, you might need add some more custom filters like filter for active/inactive entities or another filter"}),"\n",(0,n.jsx)(t.h3,{id:"custom-activeinactive-filter",children:"Custom Active/Inactive Filter"}),"\n",(0,n.jsx)(t.p,{children:"Here we will add custom filter for active/inactive entities (like temporarily disabling products without deleting them)."}),"\n",(0,n.jsx)(t.h4,{id:"create-a-custom-active-filter",children:"Create a Custom Active Filter:"}),"\n",(0,n.jsx)(t.p,{children:"Define interface for active entities:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public interface IActive\r\n{\r\n    bool IsActive { get; set; }\r\n}\n"})}),"\n",(0,n.jsx)(t.p,{children:"Implement interface in your entity"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"\r\npublic class Product : Entity<Guid>, IActive\r\n{\r\n    public string Name { get; set; } = string.Empty;\r\n    public decimal Price { get; set; }\r\n    \r\n    // IActive implementation\r\n    public bool IsActive { get; set; };\r\n}\r\n\n"})}),"\n",(0,n.jsx)(t.p,{children:"Create global filter provider"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"\r\npublic class ActiveEntitiesFilterProvider \r\n    : EFGlobalQueryFilterProvider<AppDbContext, IActive>\r\n{\r\n    protected override Expression<Func<IActiveEntity, bool>> CreateFilterExpression(\r\n        AppDbContext dbContext)\r\n    {\r\n        return entity => entity.IsActive;\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.p,{children:"Register in module"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\r\n{\r\n    public override void BuildServices(BuildServicesContext context)\r\n    {\r\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\r\n        {\r\n            // Register the custom active filter\r\n            options.AddGlobalQueryFilterProvider<ActiveEntitiesFilterProvider>();\r\n            // other options ...\r\n        });\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h4,{id:"usage-examples",children:"Usage Examples:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public class ProductService(\r\n        IRepository<Product, Guid> productRepository,\r\n        IGlobalQueryFilterManager globalFilterManager\r\n)\r\n{\r\n    // Get only active products (default behavior)\r\n    public async Task<List<Product>> GetActiveProductsAsync()\r\n    {\r\n        return await productRepository.GetListAsync();\r\n        // Automatically filters to IsActive == true\r\n    }\r\n    \r\n    // Admin method to get all products including inactive\r\n    public async Task<List<Product>> GetAllProductsAdminAsync()\r\n    {\r\n        using (globalFilterManager.Disable<IActive>())\r\n        {\r\n            return await productRepository.GetListAsync();\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"combining-multiple-filters",children:"Combining Multiple Filters"}),"\n",(0,n.jsx)(t.p,{children:"Entities can implement multiple filter interfaces:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"// Entity with both soft delete and active filters\r\npublic class Product : Entity<Guid>, ISoftDelete, IActive\r\n{\r\n    public string Name { get; set; } = string.Empty;\r\n    public decimal Price { get; set; }\r\n    \r\n    // ISoftDelete\r\n    public string? DeletedBy { get; set; }\r\n    public DateTime? DeletionDate { get; set; }\r\n    \r\n    // IActive\r\n    public bool IsActive { get; set; }\r\n}\r\n\r\n// Both filters work together automatically\r\npublic class ProductService (\r\n        IRepository<Product, Guid> productRepository,\r\n)\r\n{\r\n    public async Task<List<Product>> GetAvailableProductsAsync()\r\n    {\r\n        // Returns products where:\r\n        // IsDeleted == false AND IsActive == true\r\n        return await productRepository.GetListAsync();\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h3,{id:"disable-specific-filters-when-needed",children:"Disable specific filters when needed"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"public class AdminService (\r\n        IRepository<Product, Guid> productRepository,\r\n        IGlobalFilterManager globalFilterManager)\r\n{\r\n    \r\n    public async Task<List<Product>> GetAllProductsForAdminAsync()\r\n    {\r\n        // Disable both filters\r\n        using (globalFilterManager.Disable<ISoftDelete>())\r\n        using (globalFilterManager.Disable<IActive>())\r\n        {\r\n            // Returns ALL products including:\r\n            // - Deleted products\r\n            // - Inactive products\r\n            return await productRepository.GetListAsync();\r\n        }\r\n    }\r\n    \r\n    public async Task<List<Product>> GetInactiveButNotDeletedAsync()\r\n    {\r\n        // Disable only active filter\r\n        using (globalFilterManager.Disable<IActiveEntity>())\r\n        {\r\n            // Returns products where:\r\n            // IsDeleted == false (soft delete filter still active)\r\n            // IsActive can be true or false\r\n            return await productRepository.GetListAsync();\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"default-filter-state-value",children:"Default Filter State Value:"}),"\n",(0,n.jsx)(t.p,{children:"You can set default value for the global filter, for ex we want the the IsActive global filter enabled by default:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-csharp",children:"\r\npublic override void BuildServices(BuildServicesContext context)\r\n{\r\n    context.Services.Configure<GlobalQueryFilterOptions>(options =>\r\n    {\r\n        options.DefaultStates[typeof(IActive)] = new GlobalQueryFilterState(true);\r\n    });\r\n}\r\n\n"})}),"\n",(0,n.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.a,{href:"../unit-of-work",children:"UnitOfWork"})})}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>a});var i=r(6540);const n={},l=i.createContext(n);function s(e){const t=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),i.createElement(l.Provider,{value:t},e.children)}}}]);