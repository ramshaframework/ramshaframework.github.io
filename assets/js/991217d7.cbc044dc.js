"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[55],{2357:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"basics/persistence/entity-framework-core/global-data-filters","title":"Global Query Filters","description":"Global query filters in Ramsha automatically apply filtering conditions to all queries for specific entity types. This is particularly useful for implementing cross-cutting concerns like soft delete, multi-tenancy, or entity state management without repeating the same conditions throughout your codebase.","source":"@site/docs/basics/persistence/entity-framework-core/global-data-filters.md","sourceDirName":"basics/persistence/entity-framework-core","slug":"/basics/persistence/entity-framework-core/global-data-filters","permalink":"/docs/basics/persistence/entity-framework-core/global-data-filters","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Repositories","permalink":"/docs/basics/persistence/entity-framework-core/repositories"},"next":{"title":"Unit of Work","permalink":"/docs/basics/persistence/unit-of-work"}}');var l=i(4848),s=i(8453);const r={sidebar_position:5},a="Global Query Filters",c={},o=[{value:"Built-in Filters",id:"built-in-filters",level:2},{value:"1. Soft Delete Filter",id:"1-soft-delete-filter",level:3},{value:"Implementation:",id:"implementation",level:4},{value:"Disable Soft Deleted Filter:",id:"disable-soft-deleted-filter",level:4},{value:"Custom Filters",id:"custom-filters",level:2},{value:"Custom Active/Inactive Filter",id:"custom-activeinactive-filter",level:3},{value:"Create a Custom Active Filter:",id:"create-a-custom-active-filter",level:4},{value:"Usage Examples:",id:"usage-examples",level:4},{value:"Combining Multiple Filters",id:"combining-multiple-filters",level:2},{value:"Disable specific filters when needed",id:"disable-specific-filters-when-needed",level:3},{value:"Default Filter State Value:",id:"default-filter-state-value",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"global-query-filters",children:"Global Query Filters"})}),"\n",(0,l.jsx)(t.p,{children:"Global query filters in Ramsha automatically apply filtering conditions to all queries for specific entity types. This is particularly useful for implementing cross-cutting concerns like soft delete, multi-tenancy, or entity state management without repeating the same conditions throughout your codebase."}),"\n",(0,l.jsx)(t.h2,{id:"built-in-filters",children:"Built-in Filters"}),"\n",(0,l.jsx)(t.p,{children:"Ramsha provides built-in global filters for common scenarios like soft delete. These filters are automatically applied to entities that implement specific interfaces."}),"\n",(0,l.jsx)(t.h3,{id:"1-soft-delete-filter",children:"1. Soft Delete Filter"}),"\n",(0,l.jsx)(t.p,{children:"Ramsha includes a built-in soft delete filter that automatically filters out deleted entities."}),"\n",(0,l.jsx)(t.h4,{id:"implementation",children:"Implementation:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"// Your entity implements ISoftDelete\npublic class Product : Entity<Guid>, ISoftDelete\n{\n    public string Name { get; set; } = string.Empty;\n    public decimal Price { get; set; }\n    \n    // ISoftDelete properties (automatically filtered)\n    public string? DeletedBy { get; set; }\n    public DateTime? DeletionDate { get; set; }\n}\n"})}),"\n",(0,l.jsxs)(t.p,{children:["Usage - automatically filters out ",(0,l.jsx)(t.strong,{children:"deleted"})," products"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public class ProductService(IRepository<Product, Guid> productRepository)\n{\n    public async Task<List<Product>> GetAllProductsAsync()\n    {\n        // Automatically excludes products where IsDeleted == true\n        return await _productRepository.GetListAsync();\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h4,{id:"disable-soft-deleted-filter",children:"Disable Soft Deleted Filter:"}),"\n",(0,l.jsxs)(t.p,{children:["Sometimes may need to disable the global filter so we can use ",(0,l.jsx)(t.code,{children:"IGlobalQueryFilterManager"})," to Disable/Enable the Global filters:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public class AdminProductService (\n        IRepository<Product, Guid> productRepository,\n        IGlobalQueryFilterManager globalFilterManager)\n{\n    \n    public async Task<List<Product>> GetAllProductsIncludingDeletedAsync()\n    {\n        // Temporarily disable soft delete filter\n        using (globalFilterManager.Disable<ISoftDelete>())\n        {\n            // Returns all products including deleted ones\n            return await productRepository.GetListAsync();\n        }\n        // Filter is automatically re-enabled after the using block\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h2,{id:"custom-filters",children:"Custom Filters"}),"\n",(0,l.jsx)(t.p,{children:"While Ramsha has built-in soft delete, you might need add some more custom filters like filter for active/inactive entities or another filter"}),"\n",(0,l.jsx)(t.h3,{id:"custom-activeinactive-filter",children:"Custom Active/Inactive Filter"}),"\n",(0,l.jsx)(t.p,{children:"Here we will add custom filter for active/inactive entities (like temporarily disabling products without deleting them)."}),"\n",(0,l.jsx)(t.h4,{id:"create-a-custom-active-filter",children:"Create a Custom Active Filter:"}),"\n",(0,l.jsx)(t.p,{children:"Define interface for active entities:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public interface IActive\n{\n    bool IsActive { get; set; }\n}\n"})}),"\n",(0,l.jsx)(t.p,{children:"Implement interface in your entity"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"\npublic class Product : Entity<Guid>, IActive\n{\n    public string Name { get; set; } = string.Empty;\n    public decimal Price { get; set; }\n    \n    // IActive implementation\n    public bool IsActive { get; set; };\n}\n\n"})}),"\n",(0,l.jsx)(t.p,{children:"Create global filter provider"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"\npublic class ActiveEntitiesFilterProvider \n    : EFGlobalQueryFilterProvider<AppDbContext, IActive>\n{\n    protected override Expression<Func<IActiveEntity, bool>> CreateFilterExpression(\n        AppDbContext dbContext)\n    {\n        return entity => entity.IsActive;\n    }\n}\n"})}),"\n",(0,l.jsx)(t.p,{children:"Register in module"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public class AppModule : RamshaModule\n{\n    public override void BuildServices(BuildServicesContext context)\n    {\n        context.Services.AddRamshaDbContext<AppDbContext>(options =>\n        {\n            // Register the custom active filter\n            options.AddGlobalQueryFilterProvider<ActiveEntitiesFilterProvider>();\n            // other options ...\n        });\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h4,{id:"usage-examples",children:"Usage Examples:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public class ProductService(\n        IRepository<Product, Guid> productRepository,\n        IGlobalQueryFilterManager globalFilterManager\n)\n{\n    // Get only active products (default behavior)\n    public async Task<List<Product>> GetActiveProductsAsync()\n    {\n        return await productRepository.GetListAsync();\n        // Automatically filters to IsActive == true\n    }\n    \n    // Admin method to get all products including inactive\n    public async Task<List<Product>> GetAllProductsAdminAsync()\n    {\n        using (globalFilterManager.Disable<IActive>())\n        {\n            return await productRepository.GetListAsync();\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h2,{id:"combining-multiple-filters",children:"Combining Multiple Filters"}),"\n",(0,l.jsx)(t.p,{children:"Entities can implement multiple filter interfaces:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"// Entity with both soft delete and active filters\npublic class Product : Entity<Guid>, ISoftDelete, IActive\n{\n    public string Name { get; set; } = string.Empty;\n    public decimal Price { get; set; }\n    \n    // ISoftDelete\n    public string? DeletedBy { get; set; }\n    public DateTime? DeletionDate { get; set; }\n    \n    // IActive\n    public bool IsActive { get; set; }\n}\n\n// Both filters work together automatically\npublic class ProductService (\n        IRepository<Product, Guid> productRepository,\n)\n{\n    public async Task<List<Product>> GetAvailableProductsAsync()\n    {\n        // Returns products where:\n        // IsDeleted == false AND IsActive == true\n        return await productRepository.GetListAsync();\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h3,{id:"disable-specific-filters-when-needed",children:"Disable specific filters when needed"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"public class AdminService (\n        IRepository<Product, Guid> productRepository,\n        IGlobalFilterManager globalFilterManager)\n{\n    \n    public async Task<List<Product>> GetAllProductsForAdminAsync()\n    {\n        // Disable both filters\n        using (globalFilterManager.Disable<ISoftDelete>())\n        using (globalFilterManager.Disable<IActive>())\n        {\n            // Returns ALL products including:\n            // - Deleted products\n            // - Inactive products\n            return await productRepository.GetListAsync();\n        }\n    }\n    \n    public async Task<List<Product>> GetInactiveButNotDeletedAsync()\n    {\n        // Disable only active filter\n        using (globalFilterManager.Disable<IActiveEntity>())\n        {\n            // Returns products where:\n            // IsDeleted == false (soft delete filter still active)\n            // IsActive can be true or false\n            return await productRepository.GetListAsync();\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(t.h2,{id:"default-filter-state-value",children:"Default Filter State Value:"}),"\n",(0,l.jsx)(t.p,{children:"You can set default value for the global filter, for ex we want the the IsActive global filter enabled by default:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"\npublic override void BuildServices(BuildServicesContext context)\n{\n    context.Services.Configure<GlobalQueryFilterOptions>(options =>\n    {\n        options.DefaultStates[typeof(IActive)] = new GlobalQueryFilterState(true);\n    });\n}\n\n"})}),"\n",(0,l.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.strong,{children:(0,l.jsx)(t.a,{href:"../unit-of-work",children:"UnitOfWork"})})}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>a});var n=i(6540);const l={},s=n.createContext(l);function r(e){const t=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);