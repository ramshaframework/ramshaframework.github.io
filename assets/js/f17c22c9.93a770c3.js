"use strict";(globalThis.webpackChunkramsha_doc=globalThis.webpackChunkramsha_doc||[]).push([[5982],{1743:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"basics/architecture/hooks","title":"Ramsha Hooks","description":"Ramsha Hooks provide a structured way to execute logic during critical moments in the application lifecycle.","source":"@site/docs/basics/architecture/hooks.md","sourceDirName":"basics/architecture","slug":"/basics/architecture/hooks","permalink":"/docs/basics/architecture/hooks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Modularity","permalink":"/docs/basics/architecture/modularity"},"next":{"title":"Clean Architecture","permalink":"/docs/basics/architecture/clean-architecture"}}');var r=i(4848),s=i(8453);const t={sidebar_position:3},a="Ramsha Hooks",l={},c=[{value:"What Are Ramsha Hooks?",id:"what-are-ramsha-hooks",level:2},{value:"Why Hooks Matter",id:"why-hooks-matter",level:2},{value:"Hook Execution Flow",id:"hook-execution-flow",level:2},{value:"Init Hook",id:"init-hook",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Init Hook Interface",id:"init-hook-interface",level:3},{value:"Creating an Init Hook Contributor",id:"creating-an-init-hook-contributor",level:3},{value:"Example: Entity Framework Core Migration Hook",id:"example-entity-framework-core-migration-hook",level:4},{value:"Registering Init Hooks",id:"registering-init-hooks",level:3},{value:"Shutdown Hook",id:"shutdown-hook",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Shutdown Hook Interface",id:"shutdown-hook-interface",level:3},{value:"Creating a Shutdown Hook Contributor",id:"creating-a-shutdown-hook-contributor",level:3},{value:"Registering Shutdown Hooks",id:"registering-shutdown-hooks",level:3},{value:"Continue with:",id:"continue-with",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"ramsha-hooks",children:"Ramsha Hooks"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Ramsha Hooks"})," provide a structured way to execute logic during critical moments in the application lifecycle.\r\nThey allow modules and libraries to run code ",(0,r.jsx)(e.strong,{children:"when the application initializes"})," and ",(0,r.jsx)(e.strong,{children:"when it shuts down"}),", without tightly coupling that logic to startup files."]}),"\n",(0,r.jsx)(e.p,{children:"Hooks are especially useful for:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Database migrations"}),"\n",(0,r.jsx)(e.li,{children:"Seeding data"}),"\n",(0,r.jsx)(e.li,{children:"Resource initialization"}),"\n",(0,r.jsx)(e.li,{children:"Cleanup and graceful shutdown logic"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"what-are-ramsha-hooks",children:"What Are Ramsha Hooks?"}),"\n",(0,r.jsxs)(e.p,{children:["A ",(0,r.jsx)(e.strong,{children:"hook"})," is a contributor class that Ramsha automatically executes at a specific lifecycle moment."]}),"\n",(0,r.jsxs)(e.p,{children:["Currently, Ramsha supports ",(0,r.jsx)(e.strong,{children:"two hooks"}),":"]}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Hook"}),(0,r.jsx)(e.th,{children:"Trigger"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Init Hook"})}),(0,r.jsx)(e.td,{children:"When the application initializes"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Shutdown Hook"})}),(0,r.jsx)(e.td,{children:"When the application is stopping"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:["Each hook is implemented as a ",(0,r.jsx)(e.strong,{children:"contributor"})," class and registered through ",(0,r.jsx)(e.code,{children:"RamshaHooksOptions"}),"."]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"why-hooks-matter",children:"Why Hooks Matter"}),"\n",(0,r.jsx)(e.p,{children:"Without hooks, initialization and shutdown logic often ends up:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Inside ",(0,r.jsx)(e.code,{children:"Program.cs"})]}),"\n",(0,r.jsxs)(e.li,{children:["Inside ",(0,r.jsx)(e.code,{children:"Startup"})]}),"\n",(0,r.jsx)(e.li,{children:"Duplicated across modules"}),"\n",(0,r.jsx)(e.li,{children:"Hard to reuse or test"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Ramsha Hooks solve this by:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Centralizing lifecycle logic"}),"\n",(0,r.jsx)(e.li,{children:"Keeping modules self-contained"}),"\n",(0,r.jsx)(e.li,{children:"Improving modularity"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"hook-execution-flow",children:"Hook Execution Flow"}),"\n",(0,r.jsx)(e.p,{children:"Hooks are applied automatically when:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"app.UseRamsha();\n"})}),"\n",(0,r.jsx)(e.p,{children:"Behind the scenes, Ramsha:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Initializes the Ramsha engine"}),"\n",(0,r.jsxs)(e.li,{children:["Executes all ",(0,r.jsx)(e.strong,{children:"Init Hook contributors"})]}),"\n",(0,r.jsx)(e.li,{children:"Builds and applies the Ramsha pipeline"}),"\n",(0,r.jsx)(e.li,{children:"Registers shutdown callbacks"}),"\n",(0,r.jsxs)(e.li,{children:["Executes ",(0,r.jsx)(e.strong,{children:"Shutdown Hook contributors"})," on application stop"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"init-hook",children:"Init Hook"}),"\n",(0,r.jsx)(e.h3,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsxs)(e.p,{children:["The ",(0,r.jsx)(e.strong,{children:"Init Hook"})," runs ",(0,r.jsx)(e.strong,{children:"when the application starts"}),".\r\nIt is ideal for logic that must execute ",(0,r.jsx)(e.strong,{children:"after DI is ready"})," but ",(0,r.jsx)(e.strong,{children:"before the application starts serving requests"}),"."]}),"\n",(0,r.jsx)(e.p,{children:"Common use cases:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Applying database migrations"}),"\n",(0,r.jsx)(e.li,{children:"Seeding initial data"}),"\n",(0,r.jsx)(e.li,{children:"Initializing background resources"}),"\n",(0,r.jsx)(e.li,{children:"Preloading configuration or caches"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"init-hook-interface",children:"Init Hook Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"public interface IInitHookContributor\r\n{\r\n    Task OnInitialize(InitContext context);\r\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"creating-an-init-hook-contributor",children:"Creating an Init Hook Contributor"}),"\n",(0,r.jsxs)(e.p,{children:["Create a class inside your module or class library and implement ",(0,r.jsx)(e.code,{children:"IInitHookContributor"}),"."]}),"\n",(0,r.jsx)(e.h4,{id:"example-entity-framework-core-migration-hook",children:"Example: Entity Framework Core Migration Hook"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"using Ramsha.EntityFrameworkCore;\r\n\r\npublic class EntityFrameworkCoreInitHookContributor : IInitHookContributor\r\n{\r\n    public async Task OnInitialize(InitContext context)\r\n    {\r\n        var provider = context.ServiceProvider;\r\n        var dbContexts = provider.GetServices<IRamshaEFDbContext>();\r\n\r\n        if (dbContexts != null)\r\n        {\r\n            foreach (var db in dbContexts)\r\n            {\r\n                if (db.Database.GetPendingMigrations().Any())\r\n                {\r\n                    await db.Database.MigrateAsync();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Resolves all registered Ramsha DbContexts"}),"\n",(0,r.jsx)(e.li,{children:"Checks for pending migrations"}),"\n",(0,r.jsx)(e.li,{children:"Applies migrations automatically on startup"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"registering-init-hooks",children:"Registering Init Hooks"}),"\n",(0,r.jsxs)(e.p,{children:["Init hooks must be registered using ",(0,r.jsx)(e.code,{children:"RamshaHooksOptions"}),"."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"context.Services.Configure<RamshaHooksOptions>(options =>\r\n{\r\n    options.InitHookContributors.Add<EntityFrameworkCoreInitHookContributor>();\r\n});\n"})}),"\n",(0,r.jsxs)(e.p,{children:["This is typically done inside the ",(0,r.jsx)(e.strong,{children:"BuildServices"})," phase of a module."]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"shutdown-hook",children:"Shutdown Hook"}),"\n",(0,r.jsx)(e.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,r.jsxs)(e.p,{children:["The ",(0,r.jsx)(e.strong,{children:"Shutdown Hook"})," runs ",(0,r.jsx)(e.strong,{children:"when the application is stopping"}),"."]}),"\n",(0,r.jsx)(e.p,{children:"Use it for:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Releasing resources"}),"\n",(0,r.jsx)(e.li,{children:"Closing connections"}),"\n",(0,r.jsx)(e.li,{children:"Flushing logs"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"shutdown-hook-interface",children:"Shutdown Hook Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"public interface IShutdownHookContributor\r\n{\r\n    Task OnShutdown(ShutdownContext context);\r\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"creating-a-shutdown-hook-contributor",children:"Creating a Shutdown Hook Contributor"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'public class AppShutdownHookContributor : IShutdownHookContributor\r\n{\r\n    public Task OnShutdown(ShutdownContext context)\r\n    {\r\n        var logger = context.ServiceProvider\r\n        .GetRequiredService<ILogger<AppShutdownHookContributor>>();\r\n\r\n        logger.LogInformation("Application is shutting down...");\r\n\r\n        return Task.CompletedTask;\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h3,{id:"registering-shutdown-hooks",children:"Registering Shutdown Hooks"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"builder.Services.Configure<RamshaHooksOptions>(options =>\r\n{\r\n    options.ShutdownHookContributor.Add<AppShutdownHookContributor>();\r\n});\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"continue-with",children:"Continue with:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:(0,r.jsx)(e.a,{href:"/docs/basics/architecture/clean-architecture",children:"Clean Architecture"})})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>a});var o=i(6540);const r={},s=o.createContext(r);function t(n){const e=o.useContext(s);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);